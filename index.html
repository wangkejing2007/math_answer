<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>海聯會僑生考試 [數學科] 答案表 (110-114)</title>
    <!-- 載入 Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* 設定字體為 Inter，確保中文字體顯示良好 */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        body {
            font-family: 'Inter', 'Noto Sans TC', sans-serif;
            background-color: #0d1117; /* 深黑色背景 (黑) */
            color: #c9d1d9; /* 淺灰色文字 (輝) */
            min-height: 100vh;
        }
        /* 定義主要的藍色/紫色系作為「蘭」色調，現用於強調 */
        /* 將主標題顏色更改為純白色 #FFFFFF */
        .accent-white-title {
            color: #FFFFFF; 
        }
        /* 副標題顏色更改為 #999999 (亮灰色) */
        .subtitle-gray {
            color: #999999;
        }
        /* 蘭色調保留給答案數字 */
        .accent-indigo {
            color: #a78bfa; /* 淺靛藍色 (蘭) */
        }
        .bg-card {
            background-color: #161b22; /* 較深的灰色，作為卡片和表格背景 (輝) */
            border: 2px solid #30363d; /* 邊框顏色 */
        }
        /* 響應式表格：在小螢幕上捲動 */
        .responsive-table-container {
            overflow-x: auto;
        }
        /* 懸停效果 */
        .table-row:hover {
            background-color: #21262d; /* 懸停時的顏色變化 */
            cursor: default;
        }
        /* 題號列的樣式 */
        .question-number {
            background-color: #30363d; /* 較深的背景色來區分 */
            font-weight: 900; /* 加粗題號欄位文字 */
            color: #c9d1d9;
        }
        /* 表格頭部文字樣式 */
        .table-header-text {
            font-weight: 900; /* 極度加粗表頭文字 */
            color: #c9d1d9; /* 確保在暗色背景下對比度高 */
        }
        /* 確保表格內的 border-collapse 正常工作 */
        table {
            border-collapse: collapse;
        }
        /* 自定義樣式：統一加粗表格單元格的線條 */
        .cell-border {
            border-width: 4px; /* 將邊框寬度從 2px 增加到 4px */
            border-color: #30363d; /* 使用深色邊框來強化分隔 */
        }

        /* Q&A 區塊樣式 */
        .faq-question {
            background-color: #1f2a37; /* 比卡片背景稍微亮一點的顏色 */
            transition: background-color 0.2s;
        }
        .faq-question:hover {
            background-color: #21262d;
        }
        .faq-answer {
            background-color: #161b22;
        }
        /* 讓 Q&A 內的表格樣式符合暗色模式 */
        .faq-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
            text-align: center;
        }
        .faq-table th, .faq-table td {
            border: 1px solid #30363d;
            padding: 0.5rem;
        }
        .faq-table th {
            background-color: #30363d;
            color: #c9d1d9;
        }
        .highlight-result {
            font-weight: 800;
            color: #4ade80; /* 亮綠色突出顯示結果 */
        }
    </style>
</head>
<body class="p-4 sm:p-8">

    <div class="max-w-4xl mx-auto">
        <!-- 標題區域 - 置中對齊 -->
        <header class="mb-8 text-center">
            <!-- 應用純白標題顏色 class -->
            <h1 class="text-4xl sm:text-5xl font-extrabold accent-white-title border-b-2 pb-3 border-indigo-400/50 inline-block">
                海聯會僑生考試 [數學科]答案表
            </h1>
            <!-- 應用新的亮灰色副標題顏色 class -->
            <p class="mt-2 subtitle-gray text-2g">
                110 至 114 學年度單一選擇題標準答案 (共 10 題)
            </p>
        </header>

        <!-- 表格區域 -->
        <!-- 強化整體框架感，邊框為 4 像素深灰色 -->
        <div class="responsive-table-container bg-card shadow-xl rounded-xl p-0.5 border-4 border-gray-700 mb-12">
            <!-- 移除 divide-y，改用單元格邊框 -->
            <table class="min-w-full border-collapse border-4 border-gray-700">
                <!-- 表格標頭 -->
                <thead>
                    <tr class="text-sm uppercase tracking-wider bg-[#30363d]">
                        <!-- 所有 th 加上 cell-border class 讓線條加粗 -->
                        <th class="px-1 py-3 text-left w-1/5 question-number table-header-text cell-border">
                            題號
                        </th>
                        <th class="px-4 py-3 text-center table-header-text cell-border">114 學年</th>
                        <th class="px-4 py-3 text-center table-header-text cell-border">113 學年</th>
                        <th class="px-4 py-3 text-center table-header-text cell-border">112 學年</th>
                        <th class="px-4 py-3 text-center table-header-text cell-border">111 學年</th>
                        <th class="px-4 py-3 text-center table-header-text cell-border">110 學年</th>
                    </tr>
                </thead>

                <!-- 表格主體 -->
                <tbody id="answer-table-body" class="text-gray-200">
                    <!-- 數據將由 JavaScript 渲染 -->
                </tbody>
            </table>
        </div>
        
        <!-- Q&A 區塊 -->
        <section class="mt-8">
            <h2 class="text-2xl font-bold accent-indigo mb-4 text-center">
                常見問答 (Q&A) 區塊
            </h2>
            <div id="faq-container" class="space-y-3">
                
                <!-- Q1: 答案出現次數統計 (總體) -->
                <details class="rounded-lg shadow-md border border-gray-700">
                    <summary class="faq-question p-4 font-semibold text-lg rounded-t-lg flex justify-between items-center cursor-pointer">
                        <span class="font-extrabold accent-indigo">Q1: 五個學年度（110~114）統計，每個答案出現的次數和比例是多少？</span>
                        <svg class="w-5 h-5 transition-transform duration-300" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                    </summary>
                    <div class="faq-answer p-4 border-t border-gray-700 rounded-b-lg">
                        <p class="mb-3 text-gray-300 font-medium">
                            根據 110 至 114 學年度共 50 題單一選擇題的答案統計，各選項出現的次數和比例（由高到低排列）如下：
                        </p>
                        
                        <!-- 統計結果表格 -->
                        <table class="faq-table">
                            <thead>
                                <tr>
                                    <th>選項</th>
                                    <th>出現次數 (50 題中)</th>
                                    <th>佔總題數比例</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td class="font-bold accent-indigo">D</td>
                                    <td>15 次</td>
                                    <td>30.0%</td>
                                </tr>
                                <tr>
                                    <td class="font-bold accent-indigo">E</td>
                                    <td>11 次</td>
                                    <td>22.0%</td>
                                </tr>
                                <tr>
                                    <td class="font-bold accent-indigo">B</td>
                                    <td>9 次</td>
                                    <td>18.0%</td>
                                </tr>
                                <tr>
                                    <td class="font-bold accent-indigo">C</td>
                                    <td>8 次</td>
                                    <td>16.0%</td>
                                </tr>
                                <tr>
                                    <td class="font-bold accent-indigo">A</td>
                                    <td>7 次</td>
                                    <td>14.0%</td>
                                </tr>
                            </tbody>
                        </table>

                        <p class="mt-4 text-sm text-gray-400">
                            **結論：** 在這五個學年內，**D 選項** 是被選為標準答案頻率最高的選項，其次是 **E 選項**。
                        </p>
                    </div>
                </details>

                <!-- Q2: 單數題與偶數題的最常出現答案 -->
                <details class="rounded-lg shadow-md border border-gray-700">
                    <summary class="faq-question p-4 font-semibold text-lg rounded-t-lg flex justify-between items-center cursor-pointer">
                        <span class="font-extrabold accent-indigo">Q2: 請問單數題、出現最多次的是哪個答案？請問偶數題、出現最多次的是哪個答案？</span>
                        <svg class="w-5 h-5 transition-transform duration-300" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                    </summary>
                    <div class="faq-answer p-4 border-t border-gray-700 rounded-b-lg">
                        <p class="mb-3 text-gray-300 font-medium">
                            根據 110 至 114 學年度共 50 題的單雙數題分組統計（每組 25 題）結果如下：
                        </p>
                        
                        <!-- 統計結果表格 -->
                        <table class="faq-table">
                            <thead>
                                <tr>
                                    <th>題號組別</th>
                                    <th>最多次出現的答案</th>
                                    <th>出現次數 (佔 25 題的比例)</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td class="font-bold accent-indigo">單數題 (Q1, 3, 5, 7, 9)</td>
                                    <td class="font-bold text-xl text-yellow-300">E</td>
                                    <td>6 次 (24.0%)</td>
                                </tr>
                                <tr>
                                    <td class="font-bold accent-indigo">偶數題 (Q2, 4, 6, 8, 10)</td>
                                    <td class="font-bold text-xl text-yellow-300">D</td>
                                    <td>9 次 (36.0%)</td>
                                </tr>
                            </tbody>
                        </table>

                        <p class="mt-4 text-sm text-gray-400">
                            **詳細分析 (由高到低):**<br>
                            - **單數題：** E (6 次) > B/C/D (均為 5 次) > A (4 次)<br>
                            - **偶數題：** D (9 次) > E (6 次) > B (4 次) > A/C (均為 3 次)
                        </p>
                    </div>
                </details>

                <!-- Q3: 最佳猜題策略比較 -->
                <details class="rounded-lg shadow-md border border-gray-700" open>
                    <summary class="faq-question p-4 font-semibold text-lg rounded-t-lg flex justify-between items-center cursor-pointer">
                        <span class="font-extrabold accent-indigo">Q3: 最佳猜題策略比較：總是猜 "D" 還是根據單雙數猜 "E" 或 "D"？</span>
                        <svg class="w-5 h-5 transition-transform duration-300" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                    </summary>
                    <div class="faq-answer p-4 border-t border-gray-700 rounded-b-lg">
                        <p class="mb-3 text-gray-300 font-medium">
                            假設您對某題完全沒有頭緒，且該題為隨機抽取（奇偶題機率各 50%），兩種策略的期望成功率計算如下：
                        </p>
                        
                        <!-- 策略比較表格 -->
                        <table class="faq-table">
                            <thead>
                                <tr>
                                    <th>策略</th>
                                    <th>猜題規則</th>
                                    <th>歷史成功次數 (總題數 50)</th>
                                    <th>期望成功率</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td class="font-bold accent-indigo">策略 A (整體最佳)</td>
                                    <td>不論奇偶，一律猜 **D**</td>
                                    <td>15 次 (來自 Q1)</td>
                                    <td class="highlight-result">30.0%</td>
                                </tr>
                                <tr>
                                    <td class="font-bold accent-indigo">策略 B (單雙數分組)</td>
                                    <td>奇數題猜 **E**；偶數題猜 **D**</td>
                                    <td>6 次 (奇數題) + 9 次 (偶數題) = 15 次 (來自 Q2)</td>
                                    <td class="highlight-result">30.0%</td>
                                </tr>
                            </tbody>
                        </table>

                        <p class="mt-4 text-sm text-gray-400">
                            **結論：**
                            根據 110-114 學年度的歷史數據，這兩種猜題策略的期望成功率**相同**，均為 **30.0%**。選擇任何一種，在統計上來說結果都會是一樣的。
                        </p>
                        <p class="mt-2 text-sm text-yellow-500">
                            **💡 額外建議：** 如果您確定該題是偶數題（Q2, 4, 6, 8, 10），則策略 B（猜 D）的成功率更高達 $9/25 = 36.0\%$。因此，策略 B 雖然整體成功率相同，但能提供更有針對性的猜題依據。
                        </p>
                    </div>
                </details>
                
            </div>

        </section>

        <!-- Gemini API 功能區塊 -->
        <section class="mt-12 p-6 bg-card rounded-xl shadow-2xl border-4 border-indigo-500/50">
            <h2 class="text-2xl font-bold text-center mb-6 accent-white-title">
                ✨ Gemini 備考智能助理 ✨
            </h2>

            <!-- 1. 數學名詞查詢功能 -->
            <div class="mb-8">
                <h3 class="text-xl font-semibold accent-indigo mb-3">
                    1. 數學名詞查詢 (Google Search Grounded)
                </h3>
                <p class="text-sm text-gray-400 mb-3">
                    輸入任何數學概念或名詞，讓 Gemini 透過 Google 搜尋為您提供準確的解釋和背景知識。
                </p>
                <div class="flex flex-col sm:flex-row gap-2">
                    <input type="text" id="searchTermInput" placeholder="例如：微積分基本定理、機率的定義..."
                           class="flex-grow p-3 rounded-lg bg-[#0d1117] border border-gray-600 text-gray-200 focus:ring-indigo-500 focus:border-indigo-500">
                    <button onclick="lookupTerminology()" id="lookupButton"
                            class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-6 rounded-lg transition duration-150 shadow-md">
                        ✨ 查詢名詞
                    </button>
                </div>
                <div id="lookupResult" class="mt-4 p-4 min-h-[50px] bg-[#30363d] rounded-lg border border-indigo-400/50 text-sm whitespace-pre-wrap">
                    查詢結果將顯示於此...
                </div>
            </div>

            <!-- 2. 答案趨勢分析功能 -->
            <div>
                <h3 class="text-xl font-semibold accent-indigo mb-3">
                    2. 分析答案趨勢 (Speculative Analysis)
                </h3>
                <p class="text-sm text-gray-400 mb-3">
                    點擊按鈕，讓 Gemini 模型根據 Q1 的歷史數據（D選項明顯偏高）來提供一些有趣的見解與備考方向建議。
                </p>
                <button onclick="analyzeTrend()" id="analyzeButton"
                        class="bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-6 rounded-lg transition duration-150 shadow-md w-full sm:w-auto">
                    ✨ 分析答案趨勢
                </button>
                <div id="trendResult" class="mt-4 p-4 min-h-[50px] bg-[#30363d] rounded-lg border border-green-400/50 text-sm whitespace-pre-wrap">
                    趨勢分析結果將顯示於此...
                </div>
            </div>

        </section>


        <footer class="mt-8 text-center text-sm text-gray-500">
            <p>資料來源：110-114學年度海外聯合招生考試數學科答案卷。</p>
        </footer>
    </div>

    <script>
        // Global variables for Firebase framework compliance
        // Fix: Accessing global variables via 'window' prevents 'Cannot access before initialization' errors
        const __app_id = typeof window.__app_id !== 'undefined' ? window.__app_id : 'default-app-id';
        const __firebase_config = typeof window.__firebase_config !== 'undefined' ? window.__firebase_config : '{}';
        const __initial_auth_token = typeof window.__initial_auth_token !== 'undefined' ? window.__initial_auth_token : '';
        const apiKey = ""; // Canvas will provide this at runtime

        const answersData = [
            // 題號, 114, 113, 112, 111, 110
            { q: 1, a114: 'B', a113: 'B', a112: 'B', a111: 'D', a110: 'E' },
            { q: 2, a114: 'D', a113: 'D', a112: 'E', a111: 'E', a110: 'C' },
            { q: 3, a114: 'A', a113: 'D', a112: 'C', a111: 'D', a110: 'E' },
            { q: 4, a114: 'B', a113: 'E', a112: 'C', a111: 'B', a110: 'D' },
            { q: 5, a114: 'E', a113: 'D', a112: 'E', a111: 'C', a110: 'C' },
            { q: 6, a114: 'A', a113: 'A', a112: 'B', a111: 'D', a110: 'E' },
            { q: 7, a114: 'C', a113: 'B', a112: 'A', a111: 'C', a110: 'B' },
            { q: 8, a114: 'D', a113: 'D', a112: 'D', a111: 'E', a110: 'A' },
            { q: 9, a114: 'E', a113: 'E', a112: 'D', a111: 'A', a110: 'A' },
            { q: 10, a114: 'B', a113: 'E', a112: 'C', a111: 'D', a110: 'D' },
        ];

        const tableBody = document.getElementById('answer-table-body');

        // 渲染表格
        answersData.forEach(item => {
            const row = document.createElement('tr');
            row.classList.add('table-row');
            
            // 題號
            // 加上 cell-border class
            row.innerHTML += `<td class="question-number px-4 py-3 text-left cell-border">${item.q}</td>`;
            
            // 各學年答案
            // 所有 td 都加上 cell-border class，並使用蘭色強調答案
            row.innerHTML += `<td class="px-4 py-3 text-center font-bold text-lg accent-indigo cell-border">${item.a114}</td>`;
            row.innerHTML += `<td class="px-4 py-3 text-center font-bold text-lg accent-indigo cell-border">${item.a113}</td>`;
            row.innerHTML += `<td class="px-4 py-3 text-center font-bold text-lg accent-indigo cell-border">${item.a112}</td>`;
            row.innerHTML += `<td class="px-4 py-3 text-center font-bold text-lg accent-indigo cell-border">${item.a111}</td>`;
            row.innerHTML += `<td class="px-4 py-3 text-center font-bold text-lg accent-indigo cell-border">${item.a110}</td>`;
            
            tableBody.appendChild(row);
        });

        // --- Gemini API 核心函數 ---

        /**
         * 呼叫 Gemini API 進行內容生成，並處理指數退避重試。
         * @param {Object} payload API 請求的內容。
         * @param {number} maxRetries 最大重試次數。
         * @param {number} delay 初始延遲時間 (毫秒)。
         */
        async function callGeminiAPI(payload, maxRetries = 3, delay = 1000) {
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
            
            for (let i = 0; i < maxRetries; i++) {
                try {
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (response.ok) {
                        const result = await response.json();
                        const candidate = result.candidates?.[0];

                        if (candidate && candidate.content?.parts?.[0]?.text) {
                            const text = candidate.content.parts[0].text;
                            
                            // 提取來源 (若有使用 search grounding)
                            let sources = [];
                            const groundingMetadata = candidate.groundingMetadata;
                            if (groundingMetadata && groundingMetadata.groundingAttributions) {
                                sources = groundingMetadata.groundingAttributions
                                    .map(attribution => ({
                                        uri: attribution.web?.uri,
                                        title: attribution.web?.title,
                                    }))
                                    .filter(source => source.uri && source.title);
                            }
                            return { text, sources };
                        }
                    } else if (response.status === 429 && i < maxRetries - 1) {
                        // 處理 429 錯誤 (限速)，進行重試
                        await new Promise(resolve => setTimeout(resolve, delay * (2 ** i) + Math.random() * 1000));
                        continue;
                    }
                    throw new Error(`API response error: ${response.status} ${response.statusText}`);

                } catch (error) {
                    if (i === maxRetries - 1) {
                        console.error("Gemini API call failed after multiple retries:", error);
                        throw new Error("API 呼叫失敗，請稍後再試。");
                    }
                    await new Promise(resolve => setTimeout(resolve, delay * (2 ** i) + Math.random() * 1000));
                }
            }
        }

        /**
         * 數學名詞查詢功能
         */
        async function lookupTerminology() {
            const inputElement = document.getElementById('searchTermInput');
            const resultElement = document.getElementById('lookupResult');
            const buttonElement = document.getElementById('lookupButton');
            const userQuery = inputElement.value.trim();

            if (!userQuery) {
                resultElement.textContent = "請輸入您想查詢的數學名詞或概念。";
                return;
            }

            buttonElement.disabled = true;
            buttonElement.textContent = "🔍 查詢中...";
            resultElement.innerHTML = `<p class="text-yellow-400">正在查詢 "${userQuery}"...</p>`;

            const systemPrompt = "你是一個專門為高中生提供數學概念解釋的查詢助理。請提供簡潔、清晰的說明，內容應以繁體中文呈現。";
            
            const payload = {
                contents: [{ parts: [{ text: `解釋以下數學概念: ${userQuery}` }] }],
                tools: [{ "google_search": {} }],
                systemInstruction: { parts: [{ text: systemPrompt }] },
            };

            try {
                const { text, sources } = await callGeminiAPI(payload);
                
                let output = `<p class="font-bold mb-2">【${userQuery}】:</p>${text}`;
                
                if (sources.length > 0) {
                    output += '\n\n<p class="mt-3 text-xs text-gray-500">--- 資料來源 ---</p>';
                    sources.forEach((source, index) => {
                        output += `<p class="text-xs text-indigo-400 truncate"><a href="${source.uri}" target="_blank">${index + 1}. ${source.title || '連結'}</a></p>`;
                    });
                }

                resultElement.innerHTML = output;

            } catch (error) {
                resultElement.textContent = `查詢失敗: ${error.message}`;
            } finally {
                buttonElement.disabled = false;
                buttonElement.textContent = "✨ 查詢名詞";
            }
        }

        /**
         * 答案趨勢分析功能
         */
        async function analyzeTrend() {
            const resultElement = document.getElementById('trendResult');
            const buttonElement = document.getElementById('analyzeButton');
            
            const trendData = "D: 30.0% (15 次), E: 22.0% (11 次), B: 18.0% (9 次), C: 16.0% (8 次), A: 14.0% (7 次)。";

            buttonElement.disabled = true;
            buttonElement.textContent = "🧠 分析中...";
            resultElement.innerHTML = `<p class="text-yellow-400">正在根據歷史數據生成趨勢分析...</p>`;

            const systemPrompt = "你是一位專門分析測驗數據的備考專家。請根據提供的 50 題多選題答案分佈數據，提供一段簡潔、積極且具體的備考建議或考題設計趨勢猜測。內容應以繁體中文呈現。";
            
            const userQuery = `總體答案分佈數據為: ${trendData}。請分析為何 D 選項的比例明顯高於其他選項，並給備考學生一些建議。`;
            
            const payload = {
                contents: [{ parts: [{ text: userQuery }] }],
                systemInstruction: { parts: [{ text: systemPrompt }] },
            };

            try {
                const { text } = await callGeminiAPI(payload);
                resultElement.innerHTML = `<p class="font-bold mb-2 text-green-300">【趨勢分析報告】</p>${text}`;
            } catch (error) {
                resultElement.textContent = `分析失敗: ${error.message}`;
            } finally {
                buttonElement.disabled = false;
                buttonElement.textContent = "✨ 分析答案趨勢";
            }
        }
        
    </script>
</body>
</html>
